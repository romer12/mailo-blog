---
interface Props {
  slug: string;
  title: string;
  description?: string;
  publishDate: Date;
  category?: string;
  tags?: string[];
  heroImage?: string;
  detailed?: boolean;
}

const {
  slug,
  title,
  description,
  publishDate,
  category,
  tags = [],
  heroImage,
  detailed = true
} = Astro.props;

const formattedDate = publishDate.toLocaleDateString('zh-CN', {
  year: 'numeric',
  month: '2-digit',
  day: '2-digit'
});
---

<div class="article-row">
  {heroImage && detailed && (
    <img 
      class="cover-image" 
      src={heroImage} 
      alt={title} 
      loading="lazy"
    />
  )}
  
  <div class="article-content">
    <time class="article-date" datetime={publishDate.toISOString()}>
      {formattedDate}
    </time>

    <div class="article-header">
      <div class="article-title-wrapper">
        <a href={`/blog/${slug}`} class="article-title-link" data-astro-prefetch>
          <h2 class="article-title">{title}</h2>
        </a>
      </div>
      
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke-width="2.5"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="article-arrow"
      >
        <line x1="5" y1="12" x2="19" y2="12" class="arrow-line"></line>
        <polyline points="12 5 19 12 12 19" class="arrow-head"></polyline>
      </svg>
    </div>

    {detailed && description && (
      <p class="article-description">{description}</p>
    )}

    {detailed && category && (
      <div class="article-meta">
        <span class="meta-item">
          <i class="fas fa-folder"></i>
          {category}
        </span>
      </div>
    )}

    {detailed && tags.length > 0 && (
      <ul class="article-tags">
        {tags.map(tag => (
          <li>
            <a href={`/tags/${tag.toLowerCase().replace(/\s+/g, '-')}`} class="tag-pill">
              {tag}
            </a>
          </li>
        ))}
      </ul>
    )}
  </div>
</div>

<style lang="scss">
  @import '../styles/variables.scss';

  .article-row {
    margin: 0;
    padding: 1rem 1.25rem;
    border-radius: $radius-lg;
    border: 1px solid var(--border-color);
    background: var(--card-bg);
    transition: all 0.3s ease;
    overflow: hidden;
    position: relative;

    @media (min-width: 768px) {
      padding: 1.25rem;
    }

    &:hover {
      background: var(--hover-bg);
      border-color: $primary;
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);

      .cover-image {
        opacity: 0.7;
      }

      .article-title {
        color: $primary;
      }

      .article-arrow {
        stroke: $primary;
      }

      .arrow-line {
        transform: translateX(4px) scaleX(1);
      }

      .arrow-head {
        transform: translateX(4px);
      }
    }

    .cover-image {
      position: absolute;
      right: 0;
      top: 0;
      width: 60%;
      height: 100%;
      object-fit: cover;
      opacity: 0.5;
      border-radius: $radius-lg;
      transition: opacity 0.3s ease;
      z-index: 0;
      -webkit-mask-image: linear-gradient(to right, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 1) 100%);
      mask-image: linear-gradient(to right, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 1) 100%);

      @media (max-width: 768px) {
        width: 100%;
        height: 66%;
        -webkit-mask-image: linear-gradient(to top, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 1) 100%);
        mask-image: linear-gradient(to top, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 1) 100%);
      }
    }

    &:has(.cover-image) .article-content {
      @media (max-width: 768px) {
        padding-top: 6rem;
      }
    }

    .article-content {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;

      .article-date {
        font-size: $font-xs;
        color: var(--text-secondary);
        min-width: 95px;
        display: block;
      }

      .article-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;

        .article-title-wrapper {
          flex: 1;
          min-width: 0;

          .article-title-link {
            text-decoration: none;
            color: inherit;

            .article-title {
              font-size: 1rem;
              font-weight: 600;
              margin: 0;
              color: var(--text-primary);
              transition: color 0.3s ease;
              line-height: 1.5;

              @media (min-width: 768px) {
                font-size: 1.1rem;
              }
            }

            &:hover .article-title {
              color: $primary;
            }
          }
        }

        .article-arrow {
          flex-shrink: 0;
          stroke: var(--text-secondary);
          transition: stroke 0.3s ease;

          .arrow-line {
            transform: translateX(16px) scaleX(0);
            transition: all 0.3s ease;
          }

          .arrow-head {
            transform: translateX(0);
            transition: all 0.3s ease;
          }
        }
      }

      .article-description {
        font-size: 0.875rem;
        color: var(--text-secondary);
        line-height: 1.6;
        margin: 0;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;

        @media (min-width: 768px) {
          -webkit-line-clamp: 3;
          margin-right: 6rem;
        }
      }

      .article-meta {
        display: flex;
        align-items: center;
        gap: 1rem;
        font-size: 0.875rem;
        color: var(--text-secondary);
        font-style: italic;

        .meta-item {
          display: flex;
          align-items: center;
          gap: 0.25rem;

          i {
            font-size: 0.875rem;
          }
        }
      }

      .article-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.25rem;
        list-style: none;
        padding: 0;
        margin: 0;

        li {
          display: inline-block;
        }

        .tag-pill {
          display: inline-block;
          padding: 0.25rem $font-xs;
          font-size: $font-xs;
          font-weight: 500;
          color: var(--text-secondary);
          background: var(--hover-bg);
          border: 1px solid var(--border-color);
          border-radius: $radius-full;
          text-decoration: none;
          transition: all 0.3s ease;

          &:hover {
            background: $primary;
            border-color: $primary;
            color: white;
            transform: translateY(-2px);
          }
        }
      }
    }
  }

  :root[data-theme='dark'] {
    .article-row:hover {
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    }
  }
</style>

<script>
  // 标题 hover 时触发箭头动画
  document.addEventListener('DOMContentLoaded', () => {
    const titleLinks = document.querySelectorAll('.article-title-link');
    
    titleLinks.forEach(link => {
      const header = link.closest('.article-header');
      const arrow = header?.querySelector('.article-arrow') as SVGElement;
      const arrowLine = arrow?.querySelector('.arrow-line') as SVGElement;
      const arrowHead = arrow?.querySelector('.arrow-head') as SVGElement;
      
      if (arrow && arrowLine && arrowHead) {
        link.addEventListener('mouseenter', () => {
          arrow.style.stroke = '#6366f1';
          arrowLine.style.transform = 'translateX(4px) scaleX(1)';
          arrowHead.style.transform = 'translateX(4px)';
        });
        
        link.addEventListener('mouseleave', () => {
          arrow.style.stroke = '';
          arrowLine.style.transform = '';
          arrowHead.style.transform = '';
        });
      }
    });
  });
</script>
